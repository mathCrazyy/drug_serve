#!/bin/bash
# 阿里云函数计算启动脚本（自定义运行时）

set -e

# 进入代码目录
cd /code

# 检查并安装依赖
echo "检查 Python 依赖..."
if ! python3 -c "import uvicorn" 2>/dev/null; then
    echo "安装依赖包..."
    pip3 install --user -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
fi

# 设置 Python 路径
export PYTHONPATH=/code:$PYTHONPATH

# 启动应用
echo "启动 FastAPI 应用..."
exec python3 -m uvicorn app.main:app --host 0.0.0.0 --port 9000

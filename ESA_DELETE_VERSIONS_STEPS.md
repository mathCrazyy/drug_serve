# ESA 删除旧版本 - 详细操作步骤

## ⚠️ 当前问题

构建成功，但版本创建失败：
```
Create version failed: code version number exceeds the quota limit
```

**必须操作**：在 ESA 控制台删除旧版本后才能创建新版本。

## 📋 详细操作步骤

### 步骤 1: 登录阿里云控制台

1. 打开浏览器，访问：https://ecs.console.aliyun.com/ 或 https://console.aliyun.com/
2. 使用你的阿里云账号登录
3. 如果还没有开通 ESA 服务，需要先开通

### 步骤 2: 进入 ESA 控制台

**方法 A：直接访问**
- 访问：https://esa.console.aliyun.com/

**方法 B：从控制台导航**
1. 在阿里云控制台首页，搜索 "ESA" 或 "弹性 Serverless 应用"
2. 点击进入 ESA 服务

### 步骤 3: 找到你的应用

1. 在 ESA 控制台左侧菜单，找到 **"应用管理"** 或 **"应用列表"**
2. 在应用列表中，找到应用：**`drug_serve`**
3. 点击应用名称进入应用详情页

### 步骤 4: 进入版本管理页面

在应用详情页，找到以下标签页之一：
- **"版本管理"**
- **"代码版本"**
- **"Version"**
- **"部署版本"**

点击进入版本列表页面。

### 步骤 5: 查看版本列表

版本列表通常显示：
- **版本 ID** 或 **版本号**
- **创建时间**
- **构建状态**（成功/失败）
- **操作按钮**（删除、部署、查看详情等）

### 步骤 6: 删除旧版本

**选择要删除的版本**：
1. 优先删除：
   - ✅ 构建失败的版本
   - ✅ 最早的版本（按创建时间排序）
   - ✅ 未使用的测试版本
   - ✅ 超过 30 天的旧版本

2. **保留的版本**：
   - ⚠️ 正在生产环境使用的版本
   - ⚠️ 最近 3-5 个成功的版本
   - ⚠️ 标记为重要的版本

**执行删除**：
1. 勾选要删除的版本（可以多选）
2. 点击 **"删除"** 按钮
3. 确认删除操作
4. 等待删除完成

**建议删除数量**：
- 如果版本很多，建议删除 5-10 个旧版本
- 如果版本较少，删除 2-3 个即可

### 步骤 7: 验证删除结果

1. 确认版本列表中的版本数量已减少
2. 确认删除的版本已从列表中消失

### 步骤 8: 重新触发构建

**方法 A：在 ESA 控制台**
1. 返回应用详情页
2. 找到 **"构建"** 或 **"重新部署"** 按钮
3. 点击触发新的构建

**方法 B：通过 Git 推送**
1. 如果配置了自动构建，推送新的 commit 即可
2. 或者手动在控制台触发构建

### 步骤 9: 验证部署成功

构建完成后，应该看到：
```
✅ Build application successfully.
✅ Creating code version...
✅ Create version successfully.
✅ Deploy application successfully.
```

## 🔍 如果找不到版本管理入口

### 可能的位置：

1. **应用详情页顶部标签**
   - 查看应用详情页的所有标签页
   - 版本管理可能在第二个或第三个标签

2. **左侧菜单**
   - 在应用详情页的左侧菜单中查找
   - 可能叫 "版本"、"部署"、"历史" 等

3. **设置页面**
   - 进入应用的"设置"或"配置"页面
   - 版本管理可能在设置选项中

4. **使用搜索功能**
   - 在控制台使用搜索功能
   - 搜索 "版本"、"version"、"代码版本" 等关键词

### 如果仍然找不到：

1. **查看 ESA 帮助文档**
   - 访问：https://help.aliyun.com/product/esa.html
   - 查找版本管理相关文档

2. **联系阿里云支持**
   - 提交工单询问版本管理入口位置
   - 或联系客服获取帮助

## ⚠️ 重要注意事项

1. **删除版本不会影响运行中的实例**
   - 只有部署时才会使用版本
   - 删除旧版本不会影响当前运行的应用

2. **删除后无法恢复**
   - 确认后再删除
   - 建议先删除明显不需要的版本

3. **保留重要版本**
   - 保留正在使用的生产版本
   - 保留最近几个成功的版本作为备份

4. **定期清理**
   - 建议每月清理一次旧版本
   - 避免再次遇到配额限制问题

## 📞 需要帮助？

如果按照以上步骤仍然无法解决问题：

1. **检查配额限制**
   - 在 ESA 控制台查看配额详情
   - 确认版本数量限制是多少

2. **联系阿里云支持**
   - 提交工单申请提高配额
   - 说明项目需求和使用场景

3. **查看构建日志**
   - 在 ESA 控制台查看详细的构建日志
   - 确认是否有其他错误信息

## ✅ 成功标志

删除旧版本并重新构建后，应该看到：

```
2025-12-21 XX:XX:XX  Build application successfully.
2025-12-21 XX:XX:XX  Creating code version...
2025-12-21 XX:XX:XX  Create version successfully.
2025-12-21 XX:XX:XX  Deploy application successfully.
```

---

**操作完成后，重新触发构建即可完成部署！** 🚀


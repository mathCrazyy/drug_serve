# ESA 代码版本配额限制问题

## 问题描述

构建成功，但创建代码版本失败：
```
Create version failed: er_center create routine with assets code version error: code version number exceeds the quota limit
```

## 原因

ESA 平台对每个应用的代码版本数量有限制。当版本数量超过配额时，无法创建新版本。

## 解决方案

### 方案 1: 删除旧版本（推荐）

1. **登录阿里云 ESA 控制台**
   - 进入 ESA 应用管理页面
   - 找到你的应用：`drug_serve`

2. **查看代码版本列表**
   - 进入应用的"版本管理"或"代码版本"页面
   - 查看所有已创建的版本

3. **删除旧版本**
   - 选择不需要的旧版本
   - 点击"删除"按钮
   - 确认删除操作
   - **注意**：删除版本不会影响正在运行的实例

4. **重新触发构建**
   - 删除足够数量的旧版本后
   - 重新触发构建和部署

### 方案 2: 使用版本标签管理

如果 ESA 支持版本标签，可以：
- 为重要版本添加标签（如 `v1.0.0`, `production`, `stable`）
- 只保留带标签的版本
- 删除未标记的临时版本

### 方案 3: 联系阿里云支持

如果版本数量限制过小，可以：
- 联系阿里云客服
- 申请提高版本数量配额
- 说明项目需求和使用场景

## 预防措施

### 1. 定期清理旧版本

建议定期（如每月）清理：
- 超过 30 天的旧版本
- 未使用的测试版本
- 构建失败的版本

### 2. 使用版本命名规范

为版本添加有意义的名称或描述：
- `v1.0.0-production`
- `v1.0.1-hotfix`
- `test-2025-12-21`

### 3. 重要版本保留策略

- **生产版本**：保留所有生产环境使用的版本
- **测试版本**：只保留最近 5-10 个测试版本
- **失败版本**：可以立即删除

## 当前状态

✅ **构建成功**：
- 构建产物已生成：`frontend/dist/`
- 文件大小：67.01 KB
- 构建时间：1.10 秒

❌ **版本创建失败**：
- 需要删除旧版本后才能创建新版本

## 操作步骤（详细版）

### 步骤 1: 登录 ESA 控制台
1. 访问 [阿里云 ESA 控制台](https://esa.console.aliyun.com/)
2. 使用你的阿里云账号登录

### 步骤 2: 找到应用
1. 在左侧导航栏找到"应用管理"或"应用列表"
2. 在应用列表中找到 `drug_serve` 应用
3. 点击应用名称进入应用详情页

### 步骤 3: 进入版本管理
1. 在应用详情页，找到"版本管理"、"代码版本"或"Version"标签页
2. 点击进入版本列表页面

### 步骤 4: 查看和删除旧版本
1. 在版本列表中，你会看到所有已创建的代码版本
2. 每个版本通常显示：
   - 版本号或版本 ID
   - 创建时间
   - 构建状态
   - 操作按钮（删除、部署等）

3. **删除旧版本**：
   - 选择不需要的旧版本（建议删除最早的或失败的版本）
   - 点击"删除"按钮
   - 确认删除操作
   - **建议保留**：最近 3-5 个版本，特别是正在使用的生产版本

### 步骤 5: 重新触发构建
1. 删除足够数量的旧版本后（通常删除 2-3 个即可）
2. 返回应用详情页
3. 点击"构建"或"重新部署"按钮
4. 等待构建完成

### 如果找不到版本管理入口
- 可能在不同位置：
  - "部署管理" → "版本列表"
  - "代码管理" → "版本历史"
  - "应用设置" → "版本管理"
- 或者查看 ESA 控制台的帮助文档

## 注意事项

- ⚠️ **删除版本不会影响运行中的实例**：只有部署时才会使用版本
- ⚠️ **删除后无法恢复**：请确认后再删除
- ⚠️ **保留生产环境使用的版本**：确保生产环境稳定运行

## 相关文档

- [ESA 版本管理文档](https://help.aliyun.com/product/esa.html)
- [ESA 配额限制说明](https://help.aliyun.com/document_detail/esa-quota.html)


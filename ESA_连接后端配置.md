# ESA 前端连接后端配置指南

## ✅ 当前状态

**后端已成功部署并运行！** 🎉

- 后端地址：`http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run/`
- 测试结果：返回 `{"message":"药品识别与提醒系统 API","docs":"/docs"}`
- API 文档：`http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run/docs`

## 📋 下一步操作

### 步骤 1: 在 ESA 配置环境变量

1. **登录 ESA 控制台**
   - 进入你的应用管理页面

2. **进入构建信息**
   - 找到"构建信息"或"修改"按钮
   - 点击进入配置页面

3. **添加环境变量**
   - 找到"环境变量"部分
   - 点击"添加"或"新增"按钮
   - 添加以下环境变量：

   ```
   变量名：VITE_API_BASE_URL
   变量值：http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run
   ```

   **重要提示**：
   - ✅ 不要加末尾的斜杠 `/`
   - ✅ 使用 `http://` 协议（如果 FC 支持 HTTPS，也可以使用 `https://`）
   - ✅ 变量名必须是 `VITE_API_BASE_URL`（Vite 需要 `VITE_` 前缀）

4. **保存配置**
   - 点击"保存"按钮

### 步骤 2: 重新构建前端

1. **触发构建**
   - 在 ESA 控制台，点击"构建"或"重新构建"按钮
   - 等待构建完成

2. **检查构建日志**
   - 确认构建成功
   - 检查是否有错误信息

### 步骤 3: 部署新版本

1. **创建新版本**
   - 构建成功后，创建新的代码版本
   - 等待版本创建完成

2. **发布版本**
   - 将新版本发布到生产环境
   - 等待部署完成

### 步骤 4: 测试连接

1. **访问前端地址**
   - 打开 ESA 应用的前端地址

2. **测试功能**
   - 尝试上传图片
   - 检查是否能正常连接到后端
   - 查看浏览器控制台是否有错误

## 🔍 验证配置

### 检查环境变量是否正确

构建后的前端代码中，应该包含后端地址。可以通过以下方式验证：

1. **查看构建产物**
   - 在构建日志中搜索 `VITE_API_BASE_URL`
   - 确认值是否正确

2. **检查网络请求**
   - 打开浏览器开发者工具（F12）
   - 查看 Network 标签
   - 前端请求应该发送到 `http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run`

## ⚠️ 常见问题

### 问题 1: 前端仍显示"无法连接到服务器"

**可能原因**：
- 环境变量未正确配置
- 构建时环境变量未生效
- 需要重新构建

**解决方法**：
1. 确认环境变量名称是 `VITE_API_BASE_URL`（注意大小写）
2. 确认环境变量值是正确的后端地址
3. 删除旧版本，重新构建

### 问题 2: CORS 跨域错误

**可能原因**：
- 后端未配置 CORS 允许前端域名

**解决方法**：
- 检查后端代码中的 CORS 配置
- 确保允许 ESA 前端域名访问

### 问题 3: 环境变量未生效

**可能原因**：
- Vite 环境变量必须以 `VITE_` 开头
- 构建时环境变量未注入

**解决方法**：
1. 确认变量名是 `VITE_API_BASE_URL`
2. 重新构建前端
3. 清除浏览器缓存

## 📝 配置总结

```
ESA 环境变量配置：
┌─────────────────────────┬──────────────────────────────────────────────┐
│ 变量名                  │ 变量值                                        │
├─────────────────────────┼──────────────────────────────────────────────┤
│ VITE_API_BASE_URL       │ http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run │
└─────────────────────────┴──────────────────────────────────────────────┘
```

## 🎯 完整流程

```
1. ✅ 后端已部署（完成）
   ↓
2. 在 ESA 配置 VITE_API_BASE_URL（当前步骤）
   ↓
3. 重新构建前端
   ↓
4. 部署新版本
   ↓
5. 测试功能
```

---

**按照以上步骤配置，前端就能连接到后端了！** 🚀


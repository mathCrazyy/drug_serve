# 后端已启动！下一步操作指南

## ✅ 当前状态

你已经成功访问了后端 API，得到了正确的响应：
```json
{"message":"药品识别与提醒系统 API","docs":"/docs"}
```

这说明：
- ✅ 后端已成功启动
- ✅ 函数计算运行正常
- ✅ API 可以正常访问

## 📋 接下来需要做的

### 步骤 1：验证后端完全正常

1. **访问 API 文档页面**：
   ```
   https://你的函数计算地址/docs
   ```
   应该显示 Swagger API 文档页面，可以看到所有可用的 API 端点。

2. **测试药品列表接口**：
   ```
   https://你的函数计算地址/api/drugs
   ```
   应该返回空数组 `[]`（如果还没有上传药品）或药品列表。

### 步骤 2：获取完整的后端 API 地址

从浏览器地址栏复制你刚才访问的地址，例如：
```
https://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run
```

**重要**：如果地址末尾有路径（如 `/api`），需要确认：
- 如果地址是 `https://xxx.fcapp.run`，前端应该使用这个地址
- 如果地址是 `https://xxx.fcapp.run/api`，前端也应该使用这个地址（不要重复加 `/api`）

### 步骤 3：配置前端连接后端

#### 在 ESA 控制台配置环境变量

1. **登录阿里云 ESA 控制台**
   - 进入你的应用（drugserve）

2. **进入环境变量配置**
   - 找到"环境变量"或"Environment Variables"设置

3. **添加环境变量**：
   - **变量名**：`VITE_API_BASE_URL`
   - **变量值**：你的函数计算地址（从步骤 2 获取）
     - 例如：`https://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run`
     - **注意**：不要加末尾的斜杠 `/`

4. **保存配置**

5. **重新构建应用**
   - 在 ESA 控制台触发重新构建
   - 等待构建完成

### 步骤 4：测试前端连接

1. **访问前端页面**
   - 打开你的 ESA 应用地址

2. **打开浏览器开发者工具**（按 F12）
   - 切换到 "Network"（网络）标签

3. **尝试上传图片**
   - 在前端页面上传一张药品图片
   - 在 Network 标签中查看请求

4. **检查请求 URL**
   - 应该看到请求发送到：
     ```
     https://你的函数计算地址/api/drugs/upload
     ```
   - 如果请求失败，查看错误信息

### 步骤 5：常见问题排查

#### 问题 1：前端仍然连接 localhost

**症状**：Network 标签显示请求发送到 `http://localhost:8000`

**解决**：
- 确认 ESA 环境变量 `VITE_API_BASE_URL` 已正确配置
- 确认已重新构建应用
- 清除浏览器缓存，强制刷新（Ctrl+Shift+R 或 Cmd+Shift+R）

#### 问题 2：CORS 错误

**症状**：浏览器控制台显示 CORS 错误

**解决**：
- 后端已配置 CORS（允许所有来源）
- 如果仍有问题，检查函数计算的 CORS 配置

#### 问题 3：404 错误

**症状**：请求返回 404

**可能原因**：
- API 地址配置不正确
- 路径不匹配

**解决**：
- 确认 API 地址正确
- 确认路径是 `/api/drugs/upload`（不是 `/api/api/drugs/upload`）

#### 问题 4：上传成功但无法查看图片

**症状**：上传成功，但图片无法显示

**解决**：
- 检查图片 URL 是否正确
- 确认函数计算的静态文件服务配置正确

## 🎯 快速检查清单

### 后端检查
- [x] 访问根路径返回正确响应
- [ ] 访问 `/docs` 显示 API 文档
- [ ] 访问 `/api/drugs` 返回药品列表（可能是空数组）

### 前端配置
- [ ] 在 ESA 控制台配置了 `VITE_API_BASE_URL`
- [ ] 已重新构建 ESA 应用
- [ ] 前端页面可以正常访问

### 功能测试
- [ ] 可以上传图片
- [ ] 上传后可以看到图片
- [ ] 可以分析图片
- [ ] 可以查看药品列表

## 📝 配置示例

### ESA 环境变量配置

```
变量名: VITE_API_BASE_URL
变量值: https://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run
```

### 前端 API 请求示例

前端代码会自动使用 `VITE_API_BASE_URL`，所以：
- 上传图片：`POST https://你的地址/api/drugs/upload`
- 获取列表：`GET https://你的地址/api/drugs`
- 分析图片：`POST https://你的地址/api/drugs/{image_id}/analyze`

## 🚀 完成后的验证

配置完成后，你应该能够：

1. ✅ 在前端页面上传药品图片
2. ✅ 看到上传成功的提示
3. ✅ 点击分析按钮，等待分析完成
4. ✅ 看到识别出的药品信息（名称、生产日期、有效期等）
5. ✅ 在药品列表中看到新添加的药品

## 💡 提示

- 如果遇到问题，查看浏览器控制台的错误信息
- 查看函数计算的日志输出，了解后端处理情况
- 确保 `.env` 文件中的 API 密钥配置正确（用于图片识别）

## 🎉 完成！

配置完成后，你的药品识别系统就可以正常使用了！

如果遇到任何问题，请提供：
1. 浏览器控制台的错误信息
2. Network 标签中的请求详情
3. 函数计算的日志输出


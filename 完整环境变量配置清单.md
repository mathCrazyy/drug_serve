# 完整环境变量配置清单

## 📋 环境变量分类

环境变量分为两部分：
1. **前端环境变量**（在 ESA 中配置）
2. **后端环境变量**（在函数计算 FC 中配置）

---

## 🌐 前端环境变量（ESA）

### 必需配置

在 **ESA 控制台** → **构建信息** → **环境变量** 中添加：

| 变量名 | 变量值 | 说明 | 必需 |
|--------|--------|------|------|
| `VITE_API_BASE_URL` | `http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run` | 后端 API 地址 | ✅ 必需 |

**注意**：
- 变量名必须以 `VITE_` 开头（Vite 构建工具要求）
- 不要加末尾的斜杠 `/`
- 这是前端唯一需要的环境变量

---

## 🔧 后端环境变量（函数计算 FC）

### 必需配置

在 **函数计算控制台** → **函数配置** → **环境变量** 中添加：

| 变量名 | 变量值 | 说明 | 必需 |
|--------|--------|------|------|
| `API_BASE_URL` | `https://ark.cn-beijing.volces.com/api/v3` | 豆包 API 地址 | ✅ 必需 |
| `API_KEY` | `你的API密钥` | 豆包 API 密钥 | ✅ 必需 |
| `MODEL_ID` | `你的模型ID` | 豆包模型 ID | ✅ 必需 |

**如何获取 API_KEY 和 MODEL_ID**：
- 查看 `backend/.env` 文件
- 或查看你的 `test.py` 文件
- 或参考 `API_CONFIG_GUIDE.md`

### 可选配置（有默认值）

以下环境变量有默认值，可以不配置，但建议根据需求配置：

| 变量名 | 默认值 | 说明 | 推荐值 |
|--------|--------|------|--------|
| `DATABASE_URL` | `sqlite:///./drugs.db` | 数据库连接 | `sqlite:///./drugs.db` |
| `UPLOAD_DIR` | `uploads` | 上传文件目录 | `/tmp/uploads`（FC 推荐） |
| `MAX_FILE_SIZE` | `10485760` | 最大文件大小（字节） | `10485760`（10MB） |

**说明**：
- `DATABASE_URL`：SQLite 数据库路径，默认即可
- `UPLOAD_DIR`：在 FC 中建议使用 `/tmp/uploads`（临时目录）
- `MAX_FILE_SIZE`：10MB = 10485760 字节

---

## 📝 完整配置示例

### ESA 前端环境变量

```
变量名：VITE_API_BASE_URL
变量值：http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run
```

### 函数计算后端环境变量

```
变量名：API_BASE_URL
变量值：https://ark.cn-beijing.volces.com/api/v3

变量名：API_KEY
变量值：79de812b-68af-4513-bbc2-e158492797fe

变量名：MODEL_ID
变量值：doubao-1.5-vision-pro-250328

变量名：DATABASE_URL
变量值：sqlite:///./drugs.db

变量名：UPLOAD_DIR
变量值：/tmp/uploads

变量名：MAX_FILE_SIZE
变量值：10485760
```

---

## 🎯 配置优先级

### 前端（ESA）

**只有 1 个必需的环境变量**：
- ✅ `VITE_API_BASE_URL` - 后端 API 地址

### 后端（FC）

**必需的环境变量（3 个）**：
- ✅ `API_BASE_URL` - 豆包 API 地址
- ✅ `API_KEY` - 豆包 API 密钥
- ✅ `MODEL_ID` - 模型 ID

**可选的环境变量（3 个）**：
- ⚪ `DATABASE_URL` - 数据库连接（有默认值）
- ⚪ `UPLOAD_DIR` - 上传目录（有默认值）
- ⚪ `MAX_FILE_SIZE` - 最大文件大小（有默认值）

---

## ✅ 配置检查清单

### ESA 前端配置

- [ ] 已添加 `VITE_API_BASE_URL` 环境变量
- [ ] 变量值指向正确的后端地址
- [ ] 已重新构建前端
- [ ] 已部署新版本

### 函数计算后端配置

- [ ] 已添加 `API_BASE_URL` 环境变量
- [ ] 已添加 `API_KEY` 环境变量
- [ ] 已添加 `MODEL_ID` 环境变量
- [ ] （可选）已添加 `DATABASE_URL` 环境变量
- [ ] （可选）已添加 `UPLOAD_DIR` 环境变量
- [ ] （可选）已添加 `MAX_FILE_SIZE` 环境变量
- [ ] 已保存所有环境变量
- [ ] 已测试 API 是否正常工作

---

## 🔍 验证配置

### 验证前端配置

1. **检查构建日志**
   - 在 ESA 构建日志中搜索 `VITE_API_BASE_URL`
   - 确认值是否正确

2. **检查浏览器控制台**
   - 打开前端页面
   - 按 F12 打开开发者工具
   - 查看 Network 标签
   - API 请求应该发送到配置的后端地址

### 验证后端配置

1. **测试 API 端点**
   ```bash
   curl http://drug-api-yjdprwpdbq.cn-hangzhou.fcapp.run/
   ```
   应该返回：`{"message":"药品识别与提醒系统 API","docs":"/docs"}`

2. **测试图片上传**
   - 通过前端上传图片
   - 检查是否能正常识别

---

## ⚠️ 常见问题

### 问题 1: 前端无法连接后端

**可能原因**：
- `VITE_API_BASE_URL` 未配置或配置错误
- 构建时环境变量未生效

**解决方法**：
- 确认环境变量名称是 `VITE_API_BASE_URL`（注意大小写）
- 确认变量值是正确的后端地址
- 重新构建前端

### 问题 2: 后端 API 识别失败

**可能原因**：
- `API_KEY` 或 `MODEL_ID` 配置错误
- `API_BASE_URL` 配置错误

**解决方法**：
- 检查函数计算中的环境变量是否正确
- 确认 API_KEY 和 MODEL_ID 来自正确的来源
- 查看后端日志确认错误信息

### 问题 3: 文件上传失败

**可能原因**：
- `UPLOAD_DIR` 目录权限问题
- `MAX_FILE_SIZE` 设置过小

**解决方法**：
- 在 FC 中使用 `/tmp/uploads`（临时目录）
- 检查 `MAX_FILE_SIZE` 是否足够大

---

## 📚 相关文档

- `ESA_连接后端配置.md` - ESA 前端配置详细步骤
- `FC_环境变量配置位置.md` - FC 后端环境变量配置位置
- `API_CONFIG_GUIDE.md` - API 配置详细指南

---

**总结：前端只需要 1 个环境变量，后端需要 3 个必需 + 3 个可选环境变量。** 🚀

